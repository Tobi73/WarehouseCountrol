{"version":3,"sources":["../../src/control/product.js"],"names":["product","XlsxTemplate","require","router","post","req","res","next","body","add","status","end","JSON","stringify","error","e","get","console","log","join","__dirname","readFile","err","data","template","sheetNumber","values","people","name","age","substitute","report","generate","type","pipe","send","query","length","products","all","viewModel","map","quantity","render","search"],"mappings":"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","file":"product.js","sourcesContent":["import { Router } from 'express';\r\nimport * as product from './../bll/product.js';\r\nvar XlsxTemplate = require('xlsx-template');\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n\r\nconst router = Router();\r\n\r\nrouter.post('/add', async (req, res, next) => {\r\n    try {\r\n        const body = req.body;\r\n        await product.add(body);\r\n        return res.status(200).end(JSON.stringify({error: null}));\r\n    } catch (e) {\r\n        next(e)\r\n    }\r\n})\r\n\r\nrouter.get('/export', async (req, res, next) => {\r\n    console.log(path.join(__dirname, '..', '..', 'templates', 'export.xlsx'));\r\n    fs.readFile(path.join(__dirname, '..', '..', 'templates', 'export.xlsx'), (err, data) => {\r\n        console.log(XlsxTemplate);\r\n        var template = new XlsxTemplate(data);\r\n        var sheetNumber = 1;\r\n        var values = {\r\n                people: [\r\n                    {name: \"John Smith\", age: 20},\r\n                    {name: \"Bob Johnson\", age: 22}\r\n                ]\r\n            };\r\n        template.substitute(sheetNumber, values);\r\n        const report = template.generate({type: 'uint8array'});\r\n        // res.status(200).send(report, {});\r\n        return report;\r\n    }).pipe(res);\r\n})\r\n\r\nrouter.post('/search', async (req, res, next) => {\r\n    try {\r\n        const name = req.body.name;\r\n        return res.send(`/product/search?product=${name}`)\r\n    } catch (e) {\r\n        next(e);\r\n    }\r\n})\r\n\r\nrouter.get('/search', async (req, res, next) => {\r\n    const name = req.query.product;\r\n    if (!name || name.length == 0) {\r\n        var products = await product.all(20);\r\n        var viewModel = products.map((product) => { return {\r\n            name: product.name,\r\n            quantity: product.quantity\r\n        }});\r\n        return res.render('pages/index', { products: viewModel});\r\n    } else {\r\n        var products = await product.search(name);\r\n        var viewModel = products.map((product) => { return {\r\n            name: product.name,\r\n            quantity: product.quantity\r\n        }});\r\n        return res.render('pages/index', { products: viewModel});\r\n    }\r\n})\r\n\r\nexport default router;"]}